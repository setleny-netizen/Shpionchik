<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–π–º–µ—Ä –∏–≥—Ä—ã - –®–ø–∏–æ–Ω</title>
    
    <!-- Font Awesome –¥–ª—è –∑–Ω–∞—á–∫–æ–≤ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –®–ø–∏–æ–Ω—Å–∫–∏–µ —à—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="img/—à–ª—è–ø–∞.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/—à–ª—è–ø–∞.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu Mono', monospace;
            min-height: 100vh;
            position: relative;
            color: white;
            overflow-x: hidden;
            background: #0a0a1a;
        }

        /* –§–æ–Ω —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('img/fon2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2;
        }

        /* –°–ª–æ–π –¥–ª—è —Ä–∞–∑–º—ã—Ç–∏—è */
        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(10px);
            z-index: -1;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 30px;
            padding-bottom: 40px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–≥—Ä—ã */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-family: 'Russo One', sans-serif;
            font-size: 2.5rem;
            color: white;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–µ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-main {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* –¢–∞–π–º–µ—Ä */
        .timer-section {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .timer-display {
            font-family: 'Russo One', sans-serif;
            font-size: 5rem;
            color: #ffcc00;
            margin: 20px 0;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
            letter-spacing: 5px;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .game-button {
            padding: 15px 30px;
            font-size: 1.3rem;
            font-family: 'Russo One', sans-serif;
            font-weight: 400;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 200px;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: black;
            background: #ffffff;
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ */
        .game-button:hover:not(:disabled) {
            background: #ffd633;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 204, 0, 0.3);
        }

        .game-button:disabled {
            background: rgba(255, 255, 255, 0.3);
            color: rgba(0, 0, 0, 0.5);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ */
        .players-section {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
        }

        .players-header {
            margin-bottom: 25px;
        }

        .players-title {
            font-family: 'Russo One', sans-serif;
            font-size: 1.8rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .players-title i {
            color: #ffcc00;
        }

        /* –°–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ - –í–°–ï–ì–î–ê 2 —Å—Ç–æ–ª–±—Ü–∞ */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 10px;
        }

        /* –£–±—Ä–∞–ª –≤—Å–µ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç –Ω–∞ 1 –∫–æ–ª–æ–Ω–∫—É */
        /* –ù–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ—Å—Ç–∞–µ—Ç—Å—è 2 –∫–æ–ª–æ–Ω–∫–∏ */

        .player-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .player-card:hover {
            background: rgba(255, 255, 255, 0.18);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        .player-card.selected {
            background: rgba(255, 204, 0, 0.2);
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }

        .player-card.excluded {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.1);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .player-emoji {
            font-size: 2.2rem;
            min-width: 50px;
            text-align: center;
        }

        .player-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .player-name {
            font-size: 1.3rem;
            color: white;
            font-weight: bold;
        }

        .player-status {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            border: 3px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            animation: modalAppear 0.3s ease;
            text-align: center;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-title {
            font-family: 'Russo One', sans-serif;
            font-size: 2rem;
            color: white;
            margin-bottom: 10px;
        }

        .modal-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        .player-card-large {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .player-card-large.spy {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .player-card-large.civilian {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }

        .player-emoji-large {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .player-name-large {
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }

        .player-role-large {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .player-role-large.spy {
            background: #dc3545;
            color: white;
        }

        .player-role-large.civilian {
            background: #28a745;
            color: white;
        }

        .modal-message {
            font-size: 1.5rem;
            color: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            font-weight: bold;
        }

        .modal-message.spy-found {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
        }

        .modal-message.civilian-found {
            background: rgba(40, 167, 69, 0.2);
            color: #51cf66;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã */
        .game-over-modal {
            text-align: center;
        }

        .game-result {
            font-size: 2.5rem;
            font-family: 'Russo One', sans-serif;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
        }

        .game-result.spies-win {
            color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
            text-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
        }

        .game-result.civilians-win {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            text-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .game-result-details {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        .spies-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }

        .spies-list-title {
            font-size: 1.5rem;
            color: #dc3545;
            margin-bottom: 10px;
            text-align: center;
        }

        .spy-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: rgba(220, 53, 69, 0.1);
            margin-bottom: 10px;
            border-radius: 8px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .timer-low {
            animation: pulse 1s infinite;
            color: #dc3545 !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-card {
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–∞ –∏–≥—Ä–æ–∫–∞ */
        .selection-hint {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            margin-top: 10px;
            min-height: 24px;
        }

        /* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –≤—Ä–µ–º–µ–Ω–∏ */
        .time-warning {
            text-align: center;
            color: #ffcc00;
            font-size: 1.1rem;
            margin-top: 10px;
            display: none;
        }

        /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                padding-top: 20px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .timer-display {
                font-size: 3.5rem;
                letter-spacing: 3px;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .game-button {
                width: 100%;
                max-width: 300px;
                font-size: 1.1rem;
                padding: 15px 25px;
            }
            
            .players-grid {
                /* –í–°–ï–ì–î–ê 2 –∫–æ–ª–æ–Ω–∫–∏ */
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .player-card {
                padding: 12px;
            }
            
            .player-emoji {
                font-size: 1.8rem;
                min-width: 40px;
            }
            
            .player-name {
                font-size: 1.1rem;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .player-emoji-large {
                font-size: 3rem;
            }
            
            .player-name-large {
                font-size: 1.5rem;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
            
            .game-result {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 1.7rem;
            }
            
            .timer-display {
                font-size: 2.8rem;
            }
            
            /* –ù–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Ç–æ–∂–µ 2 –∫–æ–ª–æ–Ω–∫–∏ */
            .players-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .players-title {
                font-size: 1.5rem;
            }
            
            .player-card {
                padding: 10px;
            }
            
            .player-emoji {
                font-size: 1.6rem;
                min-width: 35px;
            }
            
            .modal-content {
                padding: 15px;
            }
            
            .player-emoji-large {
                font-size: 2.5rem;
            }
            
            .player-name-large {
                font-size: 1.3rem;
            }
            
            .modal-title {
                font-size: 1.3rem;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .game-button.modal {
                width: 100%;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (–º–µ–Ω—å—à–µ 360px) —Ç–æ–∂–µ 2 –∫–æ–ª–æ–Ω–∫–∏ */
        @media (max-width: 360px) {
            .players-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            
            .player-card {
                padding: 8px;
                min-height: 60px;
            }
            
            .player-emoji {
                font-size: 1.4rem;
                min-width: 30px;
            }
            
            .player-name {
                font-size: 0.9rem;
            }
            
            .game-button {
                font-size: 1rem;
                padding: 12px 20px;
                min-width: 180px;
            }
        }
    </style>
</head>
<body>
    
<div class="background"></div>
<div class="blur-overlay"></div>

<div class="game-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
    <div class="game-main">
        <!-- –°–µ–∫—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞ -->
        <div class="timer-section">
            <div class="timer-display" id="timerDisplay">05:00</div>
            
            <div class="timer-controls">
                <button class="game-button" id="pauseStartBtn">
                    <i class="fas fa-pause"></i> <span>–ü–∞—É–∑–∞</span>
                </button>
            </div>
            
            <div class="time-warning" id="timeWarning">
                ‚è∞ –û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏!
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="players-section">
            <div class="players-header">
                <h2 class="players-title">
                    <i class="fas fa-users"></i> –ò–≥—Ä–æ–∫–∏
                </h2>
            </div>
            
            <!-- –°–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ (–í–°–ï–ì–î–ê 2 —Å—Ç–æ–ª–±—Ü–∞) -->
            <div class="players-grid" id="playersGrid">
                <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="selection-hint" id="selectionHint">
                –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π -->
        <div class="game-controls">
            <button class="game-button" id="excludeBtn" disabled>
                <i class="fas fa-user-slash"></i> –ò—Å–∫–ª—é—á–∏—Ç—å
            </button>
            <button class="game-button" id="endGameBtn" disabled>
                <i class="fas fa-flag-checkered"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ -->
<div class="modal-overlay" id="excludeModal">
    <div class="modal-content">
        <h2 class="modal-title">–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞</h2>
        <p class="modal-subtitle" id="excludeSubtitle">–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è:</p>
        
        <div class="player-card-large" id="excludedPlayerCard">
            <!-- –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="modal-message" id="excludeMessage">
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="modal-buttons" id="excludeButtons">
            <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
<div class="modal-overlay" id="gameOverModal">
    <div class="modal-content game-over-modal">
        <h2 class="modal-title">–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
        
        <div class="game-result" id="gameResult">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="game-result-details" id="gameResultDetails">
            <!-- –î–µ—Ç–∞–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="spies-list" id="spiesList">
            <!-- –°–ø–∏—Å–æ–∫ —à–ø–∏–æ–Ω–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="modal-buttons">
            <button class="game-button" id="restartBtn">
                <i class="fas fa-redo"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const timerDisplay = document.getElementById('timerDisplay');
        const pauseStartBtn = document.getElementById('pauseStartBtn');
        const playersGrid = document.getElementById('playersGrid');
        const excludeBtn = document.getElementById('excludeBtn');
        const endGameBtn = document.getElementById('endGameBtn');
        const excludeModal = document.getElementById('excludeModal');
        const gameOverModal = document.getElementById('gameOverModal');
        const timeWarning = document.getElementById('timeWarning');
        const selectionHint = document.getElementById('selectionHint');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameSettings = null;
        let players = [];
        let spies = [];
        let civilians = [];
        let excludedPlayers = [];
        let selectedPlayerIndex = null;
        
        // –¢–∞–π–º–µ—Ä
        let totalSeconds = 0;
        let timerInterval = null;
        let isTimerRunning = true; // –¢–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
        let isTimerPaused = false;
        let isGameOver = false;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã
        function loadGameSettings() {
            const savedSettings = localStorage.getItem('spyGameSettings');
            if (!savedSettings) {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–≥—Ä—É —Å–Ω–∞—á–∞–ª–∞.');
                window.location.href = 'settings-game.html';
                return;
            }
            
            try {
                gameSettings = JSON.parse(savedSettings);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
                if (!gameSettings.players || gameSettings.players.length < 3) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞.');
                    window.location.href = 'settings-game.html';
                    return;
                }
                
                if (!gameSettings.selectedLocations || gameSettings.selectedLocations.length === 0) {
                    alert('–ù–µ –≤—ã–±—Ä–∞–Ω—ã –Ω–∞–±–æ—Ä—ã –ª–æ–∫–∞—Ü–∏–π!');
                    window.location.href = 'settings-game.html';
                    return;
                }
                
                console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', gameSettings);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
                initializeGame();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Å—Ä–∞–∑—É
                startTimer();
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                updateButtonsState();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã!');
                window.location.href = 'settings-game.html';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initializeGame() {
            // –ö–æ–ø–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            players = JSON.parse(JSON.stringify(gameSettings.players));
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–ø–∏–æ–Ω–æ–≤
            const spyCount = parseInt(gameSettings.spies || 1);
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã—Ö —à–ø–∏–æ–Ω–æ–≤
            spies = getRandomPlayers(spyCount);
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ - –º–∏—Ä–Ω—ã–µ –∂–∏—Ç–µ–ª–∏
            civilians = players.filter(player => !spies.find(spy => spy.name === player.name));
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞
            totalSeconds = gameSettings.timerEnabled ? (gameSettings.timerMinutes || 5) * 60 : 5 * 60;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∏–≥—Ä–æ–∫–æ–≤
            renderPlayers();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
            updateTimerDisplay();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
            animatePlayers();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
        function updateButtonsState() {
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∏–¥–µ—Ç
            endGameBtn.disabled = isGameOver || !isTimerRunning;
            
            // –ö–Ω–æ–ø–∫–∞ "–ò—Å–∫–ª—é—á–∏—Ç—å" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∏–≥—Ä–æ–∫
            excludeBtn.disabled = selectedPlayerIndex === null || isGameOver || excludedPlayers.length >= players.length;
            
            // –ö–Ω–æ–ø–∫–∞ –ø–∞—É–∑—ã/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
            pauseStartBtn.disabled = isGameOver;
        }
        
        // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —à–ø–∏–æ–Ω–æ–≤
        function getRandomPlayers(count) {
            const shuffled = [...players].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤
        function renderPlayers() {
            playersGrid.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.dataset.index = index;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–∫–ª—é—á–µ–Ω –ª–∏ –∏–≥—Ä–æ–∫
                const isExcluded = excludedPlayers.find(p => p.name === player.name);
                if (isExcluded) {
                    playerCard.classList.add('excluded');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ –∏–≥—Ä–æ–∫
                if (selectedPlayerIndex === index) {
                    playerCard.classList.add('selected');
                }
                
                playerCard.innerHTML = `
                    <div class="player-emoji">${player.emoji}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-status">
                            ${isExcluded ? '–ò—Å–∫–ª—é—á–µ–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω'}
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω
                if (!isExcluded) {
                    playerCard.addEventListener('click', () => selectPlayer(index));
                }
                
                playersGrid.appendChild(playerCard);
            });
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
        function animatePlayers() {
            const playerCards = document.querySelectorAll('.player-card');
            playerCards.forEach((card, index) => {
                card.style.animationDelay = (index * 0.05) + 's';
                card.style.opacity = '1';
            });
        }
        
        // –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
        function selectPlayer(index) {
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ–º –≤—ã–±–∏—Ä–∞—Ç—å
            if (isGameOver) return;
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–∂–µ –∏—Å–∫–ª—é—á–µ–Ω, –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ–º –≤—ã–±—Ä–∞—Ç—å
            const player = players[index];
            if (excludedPlayers.find(p => p.name === player.name)) return;
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
            document.querySelectorAll('.player-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ
            selectedPlayerIndex = index;
            document.querySelector(`.player-card[data-index="${index}"]`).classList.add('selected');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            selectionHint.textContent = `–í—ã–±—Ä–∞–Ω: ${player.name}. –ù–∞–∂–º–∏—Ç–µ "–ò—Å–∫–ª—é—á–∏—Ç—å"`;
            selectionHint.style.color = '#ffcc00';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateButtonsState();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–º
        function startTimer() {
            if (!isTimerRunning || isGameOver) return;
            
            timerInterval = setInterval(() => {
                if (totalSeconds <= 0) {
                    endTimer();
                    return;
                }
                
                totalSeconds--;
                updateTimerDisplay();
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥
                if (totalSeconds === 30) {
                    showTimeWarning();
                }
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥
                if (totalSeconds <= 10) {
                    timerDisplay.classList.add('timer-low');
                }
            }, 1000);
        }
        
        function pauseTimer() {
            if (!isTimerRunning || isGameOver) return;
            
            clearInterval(timerInterval);
            isTimerPaused = true;
            isTimerRunning = false;
            
            // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const icon = pauseStartBtn.querySelector('i');
            const text = pauseStartBtn.querySelector('span');
            
            icon.className = 'fas fa-play';
            text.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateButtonsState();
        }
        
        function resumeTimer() {
            if (isTimerRunning || isGameOver) return;
            
            isTimerPaused = false;
            isTimerRunning = true;
            
            // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const icon = pauseStartBtn.querySelector('i');
            const text = pauseStartBtn.querySelector('span');
            
            icon.className = 'fas fa-pause';
            text.textContent = '–ü–∞—É–∑–∞';
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
            startTimer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateButtonsState();
        }
        
        function endTimer() {
            clearInterval(timerInterval);
            timerDisplay.textContent = '00:00';
            timerDisplay.classList.add('timer-low');
            
            // –í—Ä–µ–º—è –≤—ã—à–ª–æ - —à–ø–∏–æ–Ω—ã –≤—ã–∏–≥—Ä–∞–ª–∏
            endGame('spies', '–í—Ä–µ–º—è –≤—ã—à–ª–æ! –®–ø–∏–æ–Ω—ã –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–Ω—ã–º–∏.');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –≤—Ä–µ–º–µ–Ω–∏
        function showTimeWarning() {
            timeWarning.style.display = 'block';
            timeWarning.style.animation = 'pulse 1s infinite';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                timeWarning.style.display = 'none';
            }, 5000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        function updateTimerDisplay() {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function excludePlayer() {
            if (selectedPlayerIndex === null || isGameOver) return;
            
            const player = players[selectedPlayerIndex];
            const isSpy = spies.find(spy => spy.name === player.name);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö
            excludedPlayers.push(player);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            selectedPlayerIndex = null;
            selectionHint.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è';
            selectionHint.style.color = 'rgba(255, 255, 255, 0.7)';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
            showExcludeModal(player, isSpy);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            renderPlayers();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateButtonsState();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã
            checkWinConditions();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
        function showExcludeModal(player, isSpy) {
            const excludedPlayerCard = document.getElementById('excludedPlayerCard');
            const excludeMessage = document.getElementById('excludeMessage');
            const excludeButtons = document.getElementById('excludeButtons');
            const excludeSubtitle = document.getElementById('excludeSubtitle');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            excludeSubtitle.textContent = `–ò–≥—Ä–æ–∫ ${player.name} –∏—Å–∫–ª—é—á–µ–Ω!`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–≥—Ä–æ–∫–∞
            excludedPlayerCard.innerHTML = `
                <div class="player-emoji-large">${player.emoji}</div>
                <div class="player-name-large">${player.name}</div>
                <div class="player-role-large ${isSpy ? 'spy' : 'civilian'}">
                    ${isSpy ? '–®–ü–ò–û–ù' : '–ú–ò–†–ù–´–ô –ñ–ò–¢–ï–õ–¨'}
                </div>
            `;
            excludedPlayerCard.className = `player-card-large ${isSpy ? 'spy' : 'civilian'}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (isSpy) {
                excludeMessage.textContent = 'üéâ –®–ø–∏–æ–Ω —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω! –ú–∏—Ä–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –ø–æ–±–µ–∂–¥–∞—é—Ç!';
                excludeMessage.className = 'modal-message civilian-found';
            } else {
                excludeMessage.textContent = 'üò¢ –ò–≥—Ä–æ–∫ –±—ã–ª –º–∏—Ä–Ω—ã–º –∂–∏—Ç–µ–ª–µ–º. –®–ø–∏–æ–Ω—ã –≤—Å–µ –µ—â–µ —Å—Ä–µ–¥–∏ –Ω–∞—Å!';
                excludeMessage.className = 'modal-message spy-found';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            excludeButtons.innerHTML = '';
            
            if (isSpy) {
                // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —à–ø–∏–æ–Ω, –∏–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
                excludeButtons.innerHTML = `
                    <button class="game-button" id="continueAfterSpyBtn">
                        <i class="fas fa-redo"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
                    </button>
                `;
            } else {
                // –ï—Å–ª–∏ –º–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É
                excludeButtons.innerHTML = `
                    <button class="game-button" id="continueBtn">
                        <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É
                    </button>
                `;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            excludeModal.classList.add('active');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            setTimeout(() => {
                if (isSpy) {
                    document.getElementById('continueAfterSpyBtn').addEventListener('click', () => {
                        excludeModal.classList.remove('active');
                        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —à–ø–∏–æ–Ω–∞ - –º–∏—Ä–Ω—ã–µ –≤—ã–∏–≥—Ä–∞–ª–∏
                        endGame('civilians', `–®–ø–∏–æ–Ω ${player.name} —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω!`);
                    });
                } else {
                    document.getElementById('continueBtn').addEventListener('click', () => {
                        excludeModal.classList.remove('active');
                    });
                }
            }, 100);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–±–µ–¥—ã
        function checkWinConditions() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —à–ø–∏–æ–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω—ã
            const activeSpies = spies.filter(spy => 
                !excludedPlayers.find(excluded => excluded.name === spy.name)
            );
            
            if (activeSpies.length === 0) {
                // –í—Å–µ —à–ø–∏–æ–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω—ã - –º–∏—Ä–Ω—ã–µ –≤—ã–∏–≥—Ä–∞–ª–∏
                endGame('civilians', '–í—Å–µ —à–ø–∏–æ–Ω—ã —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω—ã!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–æ—Å—å –ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∏—Ä–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π
            const activeCivilians = civilians.filter(civilian => 
                !excludedPlayers.find(excluded => excluded.name === civilian.name)
            );
            
            const activeSpiesCount = activeSpies.length;
            const activeCiviliansCount = activeCivilians.length;
            
            // –ï—Å–ª–∏ —à–ø–∏–æ–Ω–æ–≤ –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ –º–∏—Ä–Ω—ã–º –∂–∏—Ç–µ–ª—è–º, —à–ø–∏–æ–Ω—ã –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç
            if (activeSpiesCount >= activeCiviliansCount) {
                endGame('spies', '–®–ø–∏–æ–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å –±–æ–ª—å—à–µ, —á–µ–º –º–∏—Ä–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π!');
                return;
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(winner, reason) {
            if (isGameOver) return;
            
            isGameOver = true;
            clearInterval(timerInterval);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateButtonsState();
            
            const gameResult = document.getElementById('gameResult');
            const gameResultDetails = document.getElementById('gameResultDetails');
            const spiesList = document.getElementById('spiesList');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã
            if (winner === 'civilians') {
                gameResult.textContent = 'üéâ –ü–û–ë–ï–î–ê –ú–ò–†–ù–´–• –ñ–ò–¢–ï–õ–ï–ô!';
                gameResult.className = 'game-result civilians-win';
                gameResultDetails.textContent = reason;
            } else {
                gameResult.textContent = 'üïµÔ∏è –ü–û–ë–ï–î–ê –®–ü–ò–û–ù–û–í!';
                gameResult.className = 'game-result spies-win';
                gameResultDetails.textContent = reason;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —à–ø–∏–æ–Ω–æ–≤
            spiesList.innerHTML = `
                <div class="spies-list-title">–®–ø–∏–æ–Ω—ã –≤ —ç—Ç–æ–π –∏–≥—Ä–µ:</div>
                ${spies.map(spy => `
                    <div class="spy-item">
                        <div class="player-emoji" style="font-size: 1.5rem;">${spy.emoji}</div>
                        <div class="player-name">${spy.name}</div>
                    </div>
                `).join('')}
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            gameOverModal.classList.add('active');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        pauseStartBtn.addEventListener('click', function() {
            if (isGameOver) return;
            
            if (isTimerPaused) {
                resumeTimer();
            } else {
                pauseTimer();
            }
        });
        
        excludeBtn.addEventListener('click', excludePlayer);
        
        endGameBtn.addEventListener('click', function() {
            if (isGameOver) return;
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É –¥–æ—Å—Ä–æ—á–Ω–æ?')) {
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ, –ø–æ–±–µ–∂–¥–∞—é—Ç —à–ø–∏–æ–Ω—ã
                endGame('spies', '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ');
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        document.getElementById('restartBtn').addEventListener('click', function() {
            window.location.href = 'settings-game.html';
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        [excludeModal, gameOverModal].forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                excludeModal.classList.remove('active');
                gameOverModal.classList.remove('active');
            }
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadGameSettings();
    });
</script>

</body>
</html>